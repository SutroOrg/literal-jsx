"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=exports.makeParser=exports.JSXElement=exports.JSXChild=exports.JSXPlainText=exports.JSXAttribute=exports.JSXName=exports.JSIdentifier=exports.JSONObject=exports.JSONArray=exports.JSONValue=exports.JSONNumber=exports.JSONString=void 0;var _arcsecond=require("arcsecond"),_IdentifierRegex=_interopRequireDefault(require("./IdentifierRegex"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}var defaultFactory=function(a,b){for(var c=arguments.length,d=Array(2<c?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];return{_JSXElement:!0,name:a,attributes:b,children:d}},t=(0,_arcsecond.takeRight)(_arcsecond.whitespace),otherwise=function(a){return function(b){return"undefined"==typeof b?a:b}},curlyBracketed=(0,_arcsecond.between)(t((0,_arcsecond.char)("{")))(t((0,_arcsecond.char)("}"))),squareBracketed=(0,_arcsecond.between)(t((0,_arcsecond.char)("[")))(t((0,_arcsecond.char)("]"))),commaSeparated=(0,_arcsecond.sepBy)(t((0,_arcsecond.char)(","))),JSONString=(0,_arcsecond.regex)(/^\s*"[^"]*"/).map(function(a){return a.replace(/^\s*"/,"").replace(/"$/,"")});exports.JSONString=JSONString;var JSONNumber=(0,_arcsecond.regex)(/^\s*-?\s*(0|[1-9][0-9]*)(\s*\.\s*[0-9]+)?(\s*[eE]\s*[-+]?\s*[0-9]+)?/).map(function(a){return parseFloat(a.replace(/ /g,""))});exports.JSONNumber=JSONNumber;var JSONValue=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:defaultFactory;return(0,_arcsecond.recursiveParser)(function(){return(0,_arcsecond.choice)([JSXElement(a),// (!) added
JSONString,JSONNumber,JSONArray(a),JSONObject(a),t((0,_arcsecond.str)("true")).map(function(){return!0}),t((0,_arcsecond.str)("false")).map(function(){return!1}),t((0,_arcsecond.str)("null")).map(function(){return null})])})};exports.JSONValue=JSONValue;var JSONArray=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:defaultFactory;return squareBracketed(commaSeparated(JSONValue(a)))};exports.JSONArray=JSONArray;var JSONObject=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:defaultFactory;return curlyBracketed(commaSeparated((0,_arcsecond.sequenceOf)([JSONString,t((0,_arcsecond.char)(":")),JSONValue(a)]).map(function(a){var b=_slicedToArray(a,3),c=b[0],d=b[1],e=b[2];return[c,e]}))).map(function(a){return a.reduce(function(a,b){var c=_slicedToArray(b,2),d=c[0],e=c[1];return _objectSpread({},a,_defineProperty({},d,e))},{})})};exports.JSONObject=JSONObject;var JSIdentifier=t((0,_arcsecond.regex)(_IdentifierRegex["default"]));exports.JSIdentifier=JSIdentifier;var JSXName=(0,_arcsecond.sequenceOf)([JSIdentifier,(0,_arcsecond.possibly)((0,_arcsecond.choice)([(0,_arcsecond.takeRight)(t((0,_arcsecond.char)(":")))(JSIdentifier).map(function(a){return":"+a}),(0,_arcsecond.many)((0,_arcsecond.takeRight)(t((0,_arcsecond.char)(".")))(JSIdentifier)).map(function(a){return(a.length?".":"")+a.join(".")})]))]).map(function(c){var d=_slicedToArray(c,2),e=d[0],a=d[1];return e+a});exports.JSXName=JSXName;var JSXAttribute=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:defaultFactory;return(0,_arcsecond.sequenceOf)([(0,_arcsecond.sequenceOf)([JSIdentifier,(0,_arcsecond.possibly)((0,_arcsecond.takeRight)(t((0,_arcsecond.char)(":")))(JSIdentifier)).map(function(a){return a?":"+a:""})]).map(function(c){var d=_slicedToArray(c,2),e=d[0],a=d[1];return e+a}),(0,_arcsecond.possibly)((0,_arcsecond.takeRight)(t((0,_arcsecond.char)("=")))((0,_arcsecond.choice)([JSONString,curlyBracketed(JSONValue(a))]))).map(otherwise(!0))])};exports.JSXAttribute=JSXAttribute;var JSXPlainText=(0,_arcsecond.regex)(/^[^}{><]+/);exports.JSXPlainText=JSXPlainText;var JSXChild=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:defaultFactory;return(0,_arcsecond.recursiveParser)(function(){return(0,_arcsecond.choice)([JSXPlainText,JSXElement(a),curlyBracketed(JSONValue(a))])})};exports.JSXChild=JSXChild;var JSXElement=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:defaultFactory;return(0,_arcsecond.sequenceOf)([t((0,_arcsecond.char)("<")),JSXName,(0,_arcsecond.decide)(function(b){return(0,_arcsecond.sequenceOf)([(0,_arcsecond.many)(JSXAttribute(a)),(0,_arcsecond.choice)([(0,_arcsecond.sequenceOf)([t((0,_arcsecond.char)("/")),t((0,_arcsecond.char)(">"))]).map(function(){return[]}),(0,_arcsecond.sequenceOf)([t((0,_arcsecond.char)(">")),(0,_arcsecond.many)(JSXChild(a)),t((0,_arcsecond.char)("<")),t((0,_arcsecond.char)("/")),JSXName,(0,_arcsecond.decide)(function(a){return b===a?t((0,_arcsecond.char)(">")):(0,_arcsecond.fail)("closing tag name must match opening tag name")})]).map(function(a){return a[1]})])])})]).map(function(b){var c=_slicedToArray(b,3),d=c[0],e=c[1],f=_slicedToArray(c[2],2),g=f[0],h=f[1];return a.apply(void 0,[e,g].concat(_toConsumableArray(h)))})};exports.JSXElement=JSXElement;var makeParser=function(a){return(0,_arcsecond.parse)((0,_arcsecond.takeLeft)(a)(t(_arcsecond.endOfInput)))};exports.makeParser=makeParser;var _default={parse:function parse(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:defaultFactory;return(0,_arcsecond.toValue)(makeParser(JSONValue(b))(a))}};exports["default"]=_default;